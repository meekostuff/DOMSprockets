<!DOCTYPE html>
<!--
Tree demo
Copyright 2007,2013 Sean Hogan (http://www.meekostuff.net/)
All rights reserved
-->
<html>
<head>
	<title>DOMSprockets Collapsible Tree Demo</title>
	<style>
html { border: none; }
body {
	height: 100%;
	background-color: #ffffff;
	margin: 0px;
	padding: 0px;
}
#tree {
	margin: 0px;
	padding: 0px;
}
#tree label { display: block; background-color: #dddddd; border: 1px outset #dddddd; }
	</style>
	
<style>
#tree ul { margin-left: 0px; padding-left: 1em; }
#tree li.closed ul { display: none; }

/* pseudo list-style-image */
#tree li { list-style: outside disc; margin-left: 0px; padding-left: 0px; }
#tree li.open { list-style-image: url(arrow-dn.gif); }
#tree li.closed { list-style-image: url(arrow-rit.gif); }
#tree li.open ul, #tree li.closed ul { list-style-image: none; } /* IE <= 8 */
#tree li { -moz-user-select: none; }
#tree li > * { -moz-user-select: text; }
</style>
<script src="../Sprocket.js"></script>
<!--[if lte IE 8]>
<script src="../Legacy.js"></script>
<![endif]-->
<script src="../UI.js"></script>
</head>

<body>
	<div id="tree" class="nav">
		<label>Plants</label>
<ul>
	<li><a>Green algae</a>
		<ul>
			<li><a>Chlorophyta</a></li>
			<li><a>Charophyta</a></li>
		</ul>
	</li>
	<li><a>Land plants (embryophytes)</a>
		<ul>
			<li><a>Non-vascular land plants (bryophytes)</a>
				<ul>
					<li><a>Marchantiophyta - liverworts</a></li>
					<li><a>Anthocerotophyta - hornworts</a></li>
					<li><a>Bryophyta - mosses</a></li>
					<li><a>Horneophytopsida</a></li>
				</ul>
			</li>
			<li><a>Vascular plants (tracheophytes)</a>
				<ul>
					<li><a>Rhyniophyta - rhyniophytes</a></li>
					<li><a>Zosterophyllophyta - zosterophylls</a></li>
					<li><a>Lycopodiophyta - clubmosses</a></li>
					<li><a>Trimerophytophyta - trimerophytes</a></li>
					<li><a>Pteridophyta - ferns and horsetails</a></li>
					<li><a>Progymnospermophyta</a></li>
					<li><a>Seed plants (spermatophytes)</a>
						<ul>
							<li><a>Pteridospermatophyta - seed ferns</a></li>
							<li><a>Pinophyta - conifers</a></li>
							<li><a>Cycadophyta - cycads</a></li>
							<li><a>Ginkgophyta - ginkgo</a></li>
							<li><a>Gnetophyta - gnetae</a></li>
							<li><a>Magnoliophyta - flowering plants</a></li>
						</ul>
					</li>
				</ul>
			</li>
		</ul>
	</li>
	<li><a>Nematophytes</a></li>
</ul>
	</div>

<script>
(function() {

var sprockets = Meeko.sprockets, UI = Meeko.UI, DOM = Meeko.DOM;
var _ = Meeko.stuff;

//sprockets.register('#tree ul', UI.List);

var TreeItem = UI.TreeItem.evolve(
{
	setExpanded: function(state) {
		if (state == null) {
			this.removeClass('open');
			this.removeClass('closed');
		}
		else {
			this.toggleClass('open', !!state);
			this.toggleClass('closed', !state);
		}
	},
	getExpanded: function() {
		var state =
			this.hasClass('open') ? true :
			this.hasClass('closed') ? false :
			null;
		return state;
	},
	isEmpty: function() {
		var element = this.boundElement;
		for (var node=element.firstChild; node; node=node.nextSibling) {
			if (node.nodeType === 1 && node.tagName === 'UL') return false;
		}
		return true;
	}
});

sprockets.register('#tree li', TreeItem);

sprockets.register('#tree', UI.Tree, {
handlers: [
{
	type: 'click',
	delegator: 'li',
	eventPhase: 2,
	action: function(event, delegator) {
		var treeitem = UI.TreeItem(delegator);
		if (treeitem.isEmpty()) treeitem.setExpanded();
		else treeitem.setExpanded(!treeitem.getExpanded());
	}
}
],
callbacks: {
	enteredDocument: function() {
		_.forEach(this.$$('li > ul'), function(list) {
			var parent = list.parentNode;
			var treeitem = UI.TreeItem(parent);
			if (treeitem) treeitem.setExpanded(false);	
		}, this);
	}
}
});

})();
</script>

</body>
</html>
